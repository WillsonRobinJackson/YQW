var rewardTicet="";
function getCntxtPath(){
    var b=document.location.toString();
    var d=b.split("//");var a=d[1].split("/");
    var e=d[0]+"//";
    if(a){
        for(var c=0;c<a.length;c++){
            if(c==0){
                e+=a[c]
            }else{
                if(c==1){
                    e+="/"+a[c]
                }
            }
        }
    }
    return
    e
    }
    function rewardFlowShow(){
    if(isWeiXin()){
        $(".scd-share-js").unbind("click");
        $(".share-hid-js").hide();
        $(".share-hid-js").siblings(".share-mask").hide();
        $(".scd-share-js").bind("click",function(){$("#rewardFlow").show()});
        onMenuShareTimeline(shareContents,contextPath+"/jd/"+jid+"?_ch=share.web",sharetimelineReward)}$(".reward-fix").show();
        $(".sharetimeline-hidbox").bind("click",function(){$(this).hide();
        $(this).siblings(".sharetimeline-mask").hide()});
        $(".reward-fix").bind("click",function(){
            $("#rewardFlow").show()
        }
            )}

    function rewardFlowHide(){
        $("#rewardFlow").hide();
        $(".reward-fix").hide();
        $(".reward-fix").unbind("click");
        $(".scd-share-js").unbind("click");
        if(isWeiXin()){
            $(".scd-share-js").bind("click",function(){$(this).parent().siblings(".share-hidbox").show();
            $(this).parent().siblings(".share-mask").show()});
            onMenuShareTimeline(shareContents,contextPath+"/jd/"+jid+"?_ch=share.web",sharetimeline)
        }
    }
    function sharetimelineReward(){
        $("#rewardFlow").hide();
        $(".reward-fix").hide();
        $(".reward-fix").unbind("click");
        var c=getLocalStorageValue("xuid");
        var b=getLocalStorageValue("weChatOpenId",true);
        rewardTicket();
        shareStat();
        if(c&&b){
            if(allowShareCashCounts>0){
                window.location.href=contextPath+"/receiveWxReward?jobId="+jid+"&rewardTkt="+rewardTicet
            }else{
                if(allowCounts>0){
                    window.location.href=contextPath+"/receiveFlowLogin?jobId="+jid+"&rewardTkt="+rewardTicet
                }
            }
        }else{
            if(isWeiXin()){var d=contextPath+"/receiveFlow?jobId="+jid+"&rewardTkt="+rewardTicet;
            var a="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+appid+"&redirect_uri="+encodeURIComponent(d)+"&response_type=json&scope=snsapi_base&state=0&connect_redirect=1#wechat_redirect";
            window.location.href=a}}}function sharetimeline(){$("#rewardFlow").hide();
            $(".reward-fix").hide();$(".reward-fix").unbind("click");
            $(".share-hid-js").hide();$(".share-hid-js").siblings(".share-mask").hide();
            shareStat()}function shareStat(){
                $.ajax({
                    url:contextPath+"/weChat/shareStat",
                    async:false,data:"jid="+jid,type:"POST",
                    dataType:"json",success:function(a){},
                    error:function(a){}})}var rewardFlowFlag=false;
                    function rewardFlowSend(a,b){if(rewardFlowFlag){
                        return
                    }rewardFlowFlag=true;
                    $("#receiveFlow").unbind("click");
                    $.ajax({
                        url:contextPath+"/rewardFlow/send",
                        async:false,data:{jobId:a,rewardTkt:b},
                        type:"POST",
                        dataType:"json",
                        success:function(c){rewardFlowFlag=false;
                        $("#rewardFlowSend").hide();
                        if(c.errorMsg=="job_not_found"){
                            $("#others").show();allert_tanshort("无此职位")
                        }else{
                            if(c.errorMsg=="job_closed"){
                                $("#others").show();
                                allert_tanshort("职位已下线")
                            }else{
                                if(c.errorMsg=="already_send"){
                                    $("#others").show();
                                    allert_tanlong("该职位红包已领!")
                                }else{
                                    if(c.errorMsg=="ticket_error"){
                                        $("#rewardFlowZero").show()
                                    }else{
                                        if(c.errorMsg=="rewardFlow_end"||c.errorMsg=="errorMsg"||c.errorMsg=="already_top"){
                                            $("#rewardFlowZero").show()
                                        }else{if(c.success==="true"){
                                            var d=c.flowpkg;
                                            if(d=="10"){
                                                $("#rewardFlow10").show();
                                                $("#rewardFlow10").find("p").find("span").html(mobile)
                                            }else{if(d=="20"){
                                                $("#rewardFlow20").show();
                                                $("#rewardFlow20 p span").find("p").find("span").html(mobile)
                                            }
                                            }
                                            return true
                                        }
                                        }
                                    }
                                }
                            }
                        }
                        }
                    })
                    }
                    var wxRewardFlag=false;
                    function wxRewardSend(a,c){
                        if(wxRewardFlag){
                            return}wxRewardFlag=true;
                            var b=getLocalStorageValue("weChatOpenId",true);
                            $("#receiveFlow").unbind("click");
                            $.ajax({
                                url:contextPath+"/wxreward/share",
                                data:{openid:b,jobId:a,rewardTkt:c},
                                type:"POST",
                                dataType:"json",
                                success:function(e){
                                    $("#rewardFlowSend").hide();
                                    wxRewardFlag=false;if(e.resultCode&&e.resultCode==="SUCCESS"){
                                        try{
                                            var f=window.sessionStorage.wxSubscribe;
                                            if(f&&f=="true"){
                                                $("#wxSubscribe").show()
                                            }else{
                                                $("#wxUnSubscribe").show()
                                            }
                                        }catch(d){

                                        }return true
                                    }else{
                                        if(e.errorMsg=="job_not_found"){
                                            allert_tanshort("无此职位")
                                        }else{
                                            if(e.errorMsg=="job_closed"){
                                                allert_tanshort("职位已下线")
                                            }else{
                                                if(e.errorMsg=="already_send"){
                                                    $("#wxAlreadyGet").show()
                                                }else{
                                                    if(e.errorMsg=="ticket_error"){
                                                        $("#wxRewardEnd").show()
                                                    }else{
                                                        if(e.errorMsg=="shareReward_end"||e.errorMsg=="errorMsg"||e.errorMsg=="already_top"){
                                                            $("#wxRewardEnd").show()
                                                        }else{if(e.errorMsg=="nologin"){
                                                            window.location.href=contextPath+"/receiveFlow?jobId="+jid+"&rewardTkt="+c
                                                        }else{
                                                            $("#wxRewardEnd").show()
                                                        }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            })
                    }
                    function rewardTicket(){
                        $.ajax({
                            url:contextPath+"/rewardFlow/ticket",
                            async:false,
                            type:"POST",
                            dataType:"json",
                            success:function(a){rewardTicet=a.ticket},
                            error:function(a){

                            }
                        })
                    };